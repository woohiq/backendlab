<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Record Game</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .header {
      position: absolute;
      top: 20px;
      left: 20px;
    }

    .home-button {
      display: inline-block;
      text-decoration: none;
      font-size: 24px;
      background-color: #ffffffcc;
      padding: 8px 12px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      color: #333;
      transition: background-color 0.2s;
    }

    .home-button:hover {
      background-color: #e0e0e0;
    }

    .container {
      max-width: 800px;
      width: 100%;
      margin-top: 80px;
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 40px;
    }

    .recording-section {
      margin-bottom: 40px;
      padding: 30px;
      background: #f8f9fa;
      border-radius: 15px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .recording-section h2 {
      color: #667eea;
      margin-bottom: 20px;
      font-size: 22px;
    }

    .button-group {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    button {
      flex: 1;
      min-width: 150px;
      padding: 15px 25px;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .record-btn {
      background-color: #e74c3c;
      color: white;
    }

    .record-btn:hover {
      background-color: #c0392b;
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
    }

    .record-btn.recording {
      background-color: #95a5a6;
      animation: pulse 1.5s infinite;
    }

    .play-btn {
      background-color: #3498db;
      color: white;
    }

    .play-btn:hover:not(:disabled) {
      background-color: #2980b9;
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
    }

    .play-btn:disabled {
      background-color: #bdc3c7;
      cursor: not-allowed;
      opacity: 0.6;
    }

    .status {
      margin-top: 15px;
      padding: 10px;
      background: white;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
      color: #555;
      min-height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .status.active {
      color: #e74c3c;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.6;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <a href="/" class="home-button">ğŸ </a>
  </div>

  <div class="container">
    <h1>ğŸ¤ Record Game ğŸµ</h1>

    <!-- ì²« ë²ˆì§¸ ë…¹ìŒ ì„¹ì…˜ -->
    <div class="recording-section">
      <h2>ğŸ“¼ Recording 1</h2>
      <div class="button-group">
        <button id="record1" class="record-btn">ğŸ”´ ë…¹ìŒ ì‹œì‘</button>
        <button id="play1" class="play-btn" disabled>â–¶ï¸ ì—­ì¬ìƒ</button>
      </div>
      <div id="status1" class="status">ë…¹ìŒì„ ì‹œì‘í•˜ì„¸ìš”</div>
    </div>

    <!-- ë‘ ë²ˆì§¸ ë…¹ìŒ ì„¹ì…˜ -->
    <div class="recording-section">
      <h2>ğŸ“¼ Recording 2</h2>
      <div class="button-group">
        <button id="record2" class="record-btn">ğŸ”´ ë…¹ìŒ ì‹œì‘</button>
        <button id="play2" class="play-btn" disabled>â–¶ï¸ ì—­ì¬ìƒ</button>
      </div>
      <div id="status2" class="status">ë…¹ìŒì„ ì‹œì‘í•˜ì„¸ìš”</div>
    </div>
  </div>

  <script>
    // ë…¹ìŒ ê´€ë ¨ ë³€ìˆ˜
    let mediaRecorder1, mediaRecorder2;
    let audioChunks1 = [], audioChunks2 = [];
    let audioBlob1, audioBlob2;

    // ë²„íŠ¼ ë° ìƒíƒœ ìš”ì†Œ
    const record1Btn = document.getElementById('record1');
    const play1Btn = document.getElementById('play1');
    const status1 = document.getElementById('status1');

    const record2Btn = document.getElementById('record2');
    const play2Btn = document.getElementById('play2');
    const status2 = document.getElementById('status2');

    // ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸
    const AudioContext = window.AudioContext || window.webkitAudioContext;

    // ì²« ë²ˆì§¸ ë…¹ìŒ ë²„íŠ¼
    record1Btn.addEventListener('click', async () => {
      if (mediaRecorder1 && mediaRecorder1.state === 'recording') {
        // ë…¹ìŒ ì¤‘ì§€
        mediaRecorder1.stop();
        record1Btn.textContent = 'ğŸ”´ ë…¹ìŒ ì‹œì‘';
        record1Btn.classList.remove('recording');
        status1.textContent = 'ë…¹ìŒ ì™„ë£Œ! ì—­ì¬ìƒ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”';
        status1.classList.remove('active');
      } else {
        // ë…¹ìŒ ì‹œì‘
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          audioChunks1 = [];
          mediaRecorder1 = new MediaRecorder(stream);

          mediaRecorder1.ondataavailable = (event) => {
            audioChunks1.push(event.data);
          };

          mediaRecorder1.onstop = () => {
            audioBlob1 = new Blob(audioChunks1, { type: 'audio/webm' });
            play1Btn.disabled = false;
            stream.getTracks().forEach(track => track.stop());
          };

          mediaRecorder1.start();
          record1Btn.textContent = 'â¹ï¸ ë…¹ìŒ ì¤‘ì§€';
          record1Btn.classList.add('recording');
          status1.textContent = 'ğŸ™ï¸ ë…¹ìŒ ì¤‘...';
          status1.classList.add('active');
          play1Btn.disabled = true;
        } catch (err) {
          console.error('ë§ˆì´í¬ ì ‘ê·¼ ì˜¤ë¥˜:', err);
          status1.textContent = 'ë§ˆì´í¬ ì ‘ê·¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤';
        }
      }
    });

    // ì²« ë²ˆì§¸ ì—­ì¬ìƒ ë²„íŠ¼
    play1Btn.addEventListener('click', async () => {
      if (!audioBlob1) return;
      
      status1.textContent = 'â³ ì—­ì¬ìƒ ì¤€ë¹„ ì¤‘...';
      await reverseAndPlay(audioBlob1, status1);
    });

    // ë‘ ë²ˆì§¸ ë…¹ìŒ ë²„íŠ¼
    record2Btn.addEventListener('click', async () => {
      if (mediaRecorder2 && mediaRecorder2.state === 'recording') {
        // ë…¹ìŒ ì¤‘ì§€
        mediaRecorder2.stop();
        record2Btn.textContent = 'ğŸ”´ ë…¹ìŒ ì‹œì‘';
        record2Btn.classList.remove('recording');
        status2.textContent = 'ë…¹ìŒ ì™„ë£Œ! ì—­ì¬ìƒ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”';
        status2.classList.remove('active');
      } else {
        // ë…¹ìŒ ì‹œì‘
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          audioChunks2 = [];
          mediaRecorder2 = new MediaRecorder(stream);

          mediaRecorder2.ondataavailable = (event) => {
            audioChunks2.push(event.data);
          };

          mediaRecorder2.onstop = () => {
            audioBlob2 = new Blob(audioChunks2, { type: 'audio/webm' });
            play2Btn.disabled = false;
            stream.getTracks().forEach(track => track.stop());
          };

          mediaRecorder2.start();
          record2Btn.textContent = 'â¹ï¸ ë…¹ìŒ ì¤‘ì§€';
          record2Btn.classList.add('recording');
          status2.textContent = 'ğŸ™ï¸ ë…¹ìŒ ì¤‘...';
          status2.classList.add('active');
          play2Btn.disabled = true;
        } catch (err) {
          console.error('ë§ˆì´í¬ ì ‘ê·¼ ì˜¤ë¥˜:', err);
          status2.textContent = 'ë§ˆì´í¬ ì ‘ê·¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤';
        }
      }
    });

    // ë‘ ë²ˆì§¸ ì—­ì¬ìƒ ë²„íŠ¼
    play2Btn.addEventListener('click', async () => {
      if (!audioBlob2) return;
      
      status2.textContent = 'â³ ì—­ì¬ìƒ ì¤€ë¹„ ì¤‘...';
      await reverseAndPlay(audioBlob2, status2);
    });

    // ì˜¤ë””ì˜¤ë¥¼ ì—­ì¬ìƒí•˜ëŠ” í•¨ìˆ˜
    async function reverseAndPlay(blob, statusElement) {
      try {
        const arrayBuffer = await blob.arrayBuffer();
        const audioContext = new AudioContext();
        const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);

        // ì˜¤ë””ì˜¤ ë°ì´í„°ë¥¼ ì—­ìˆœìœ¼ë¡œ ë³€í™˜
        const reversedBuffer = audioContext.createBuffer(
          audioBuffer.numberOfChannels,
          audioBuffer.length,
          audioBuffer.sampleRate
        );

        for (let channel = 0; channel < audioBuffer.numberOfChannels; channel++) {
          const channelData = audioBuffer.getChannelData(channel);
          const reversedData = reversedBuffer.getChannelData(channel);
          for (let i = 0; i < channelData.length; i++) {
            reversedData[i] = channelData[channelData.length - 1 - i];
          }
        }

        // ì—­ì¬ìƒ
        const source = audioContext.createBufferSource();
        source.buffer = reversedBuffer;
        source.connect(audioContext.destination);
        
        statusElement.textContent = 'ğŸ”Š ì—­ì¬ìƒ ì¤‘...';
        statusElement.classList.add('active');
        
        source.onended = () => {
          statusElement.textContent = 'ì—­ì¬ìƒ ì™„ë£Œ!';
          statusElement.classList.remove('active');
        };
        
        source.start();
      } catch (err) {
        console.error('ì—­ì¬ìƒ ì˜¤ë¥˜:', err);
        statusElement.textContent = 'ì—­ì¬ìƒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ';
        statusElement.classList.remove('active');
      }
    }
  </script>
</body>
</html>

